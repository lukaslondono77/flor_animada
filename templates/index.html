<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Flor Animada - AplicaciÃ³n interactiva para mostrar imÃ¡genes por nombre">
    <meta name="keywords" content="flor, animada, imÃ¡genes, interactivo">
    <title>Flor Animada</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="preload" href="/static/images/pedro.jpeg" as="image">
    <link rel="preload" href="/static/images/arturo.jpeg" as="image">
    <link rel="preload" href="/static/images/julian.jpeg" as="image">
    <link rel="preload" href="/static/images/gina.jpeg" as="image">
</head>
<body>
    <div class="container">
        <h1>ðŸŒ¸ Flor Animada</h1>
        <form method="POST" id="mainForm">
            <input type="text" name="nombre" placeholder="Escribe Arturo, Julian o Gina" required autocomplete="off" autofocus>
            <button type="submit" name="accion" value="enviar">âœ¨ Enviar</button>
        </form>

        {% if nombre %}
            <div class="loading-container" id="loadingContainer">
                <img src="/static/images/pedro.jpeg" alt="Cargando..." class="loading-image" loading="eager">
                <p>ðŸŽ¨ Cargando imagen mÃ¡gica...</p>
            </div>
            <form method="POST" class="reset-form">
                <button type="submit" name="borrar">ðŸ”„ Borrar y Reiniciar</button>
            </form>
            
            <script>
                // Optimized loading with requestAnimationFrame for better performance
                (function() {
                    const container = document.getElementById('loadingContainer');
                    const startTime = performance.now();
                    const duration = 3000; // 3 seconds
                    
                    function updateLoading(currentTime) {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        
                        if (progress >= 1) {
                            // Use requestIdleCallback for better performance
                            if (window.requestIdleCallback) {
                                requestIdleCallback(() => {
                                    container.innerHTML = '<img src="/static/images/{{ imagen }}" alt="{{ nombre }}" class="final-image" loading="eager">';
                                });
                            } else {
                                setTimeout(() => {
                                    container.innerHTML = '<img src="/static/images/{{ imagen }}" alt="{{ nombre }}" class="final-image" loading="eager">';
                                }, 0);
                            }
                        } else {
                            requestAnimationFrame(updateLoading);
                        }
                    }
                    
                    requestAnimationFrame(updateLoading);
                })();
            </script>
        {% endif %}
    </div>
    
    <!-- Performance monitoring -->
    <script>
        // Simple performance monitoring
        window.addEventListener('load', () => {
            if ('performance' in window) {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                console.log(`Page loaded in ${loadTime}ms`);
            }
        });
    </script>
</body>
</html>
